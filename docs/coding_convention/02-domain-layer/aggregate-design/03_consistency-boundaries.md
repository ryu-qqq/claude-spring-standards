# Consistency Boundaries (Domain‑Only Scope) — 즉시/최종 일관성의 의미 정리

> **중요**: **트랜잭션 경계/Outbox/Saga/리트라이/멱등성**의 구체 구현은 **애플리케이션 레이어** 문서에서 다룬다.  
> 본 문서는 **도메인 관점에서 ‘무엇을 보장해야 하는가’**만 정의한다.

## 1) 즉시 일관성 (한 Aggregate 내부)
- 단일 Aggregate 내부의 상태 전이는 **항상 즉시 일관성**을 가져야 한다.
- 전이는 **원자적**이어야 하고, 메서드 종료 시 **불변식이 만족**되어야 한다.

## 2) 최종 일관성 (Aggregate 간 협력)
- 다른 Aggregate와의 협력은 **도메인 이벤트**로 표현한다.
- 이벤트의 **발행/재시도/순서/멱등성**은 애플리케이션 레이어가 책임진다.
- 도메인은 이벤트 **정의/의미/발생 시점**만 명확히 기술한다.

### 이벤트 스키마 표준(도메인 관점)
- `eventId` (UUID), `aggregateType`, `aggregateId`, `version`, `occurredAt`, `payload`
- 이벤트 명명: **과거시제 + 도메인 용어** (예: `OrderConfirmed`, `InventoryReserved`)

## 3) 정책 선언 (도메인 규약)
- **Cross‑aggregate 쓰기를 금지**하고, 반드시 이벤트 기반 분해를 채택한다.
- **No‑Association 정책**을 따른다: 참조는 **typed id**로만.
- **트랜잭션 용어/JPA 전략 등 영속성 세부**는 본 문서에 포함하지 않는다.

## 4) 체크리스트
- [ ] 전이 메서드 종료 시 불변식이 보장되는가?
- [ ] 이벤트의 의미와 발생 타이밍이 명확한가?
- [ ] Cross‑aggregate 변경을 이벤트로 분해했는가?