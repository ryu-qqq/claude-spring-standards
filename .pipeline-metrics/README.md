# .pipeline-metrics/ - CI/CD Pipeline Metrics Directory

**Purpose**: Store CI/CD pipeline execution metrics and failure reports

**⚠️ Important**: This directory is **NOT** related to Windsurf Cascade (IntelliJ plugin).
It only stores metrics from `tools/pipeline/` shell scripts (pr_gate, test_unit, validate_conventions, etc).

## Structure

```
.pipeline-metrics/
├── README.md (this file)
├── metrics.jsonl          # Pipeline execution metrics (auto-generated)
└── report.md              # Failure report (auto-generated)
```

## Files

### metrics.jsonl

**Format**: Tab-separated JSONL (one line per execution)

```
<timestamp>\t<task_name>\t<status_code>\t<duration_seconds>
```

**Example**:
```
1698765432	validate_conventions	0	5
1698765437	test_unit	1	120
1698765557	pr_gate	0	180
```

**Usage**: Analyze pipeline performance and success rates

```bash
# Average duration by task
cat .pipeline-metrics/metrics.jsonl | awk '{sum[$2]+=$4; count[$2]++} END {for (task in sum) print task, sum[task]/count[task]}'

# Success rate by task
cat .pipeline-metrics/metrics.jsonl | awk '{total[$2]++; if($3==0) success[$2]++} END {for (task in total) print task, (success[task]/total[task])*100 "%"}'
```

### report.md

**Format**: Markdown failure report

**Auto-generated by**: `tools/pipeline/common.sh::report_failure()`

**Example**:
```markdown
## Pipeline Failure Report
**Date**: 2024-10-29T14:30:00
**Task**: validate_conventions
**Error**: Lombok annotations detected

### Next Steps
1. Review the error details above
2. Fix the issues in your code
3. Re-run the pipeline

### Build Reports
- Checkstyle: build/reports/checkstyle/main.html
- SpotBugs: build/reports/spotbugs/main.html
```

## Integration

### Pipeline Scripts

All scripts in `tools/pipeline/` automatically write to this directory:

```bash
# From tools/pipeline/common.sh
metric validate_conventions 0 5    # Success, 5 seconds
metric test_unit 1 120             # Failed, 120 seconds
```

### CI/CD

CI workflows can collect and archive these files:

```yaml
- name: Upload Metrics
  uses: actions/upload-artifact@v3
  with:
    name: pipeline-metrics
    path: .pipeline-metrics/
```

## Gitignore

These files are gitignored (auto-generated):
- `.pipeline-metrics/metrics.jsonl`
- `.pipeline-metrics/report.md`

Only `.pipeline-metrics/README.md` and `.pipeline-metrics/.gitkeep` are tracked.
