-- ============================================================
-- V3: Resource Template 시드 데이터
-- ============================================================
-- 설명: 모듈별 리소스 템플릿 (설정 파일, 엔티티, Config 클래스 등)
-- 대상: persistence.yml, application.yml, local/prod 환경 설정 등
-- ============================================================

-- 기존 데이터가 있으면 스킵 (멱등성 보장)
-- INSERT IGNORE를 사용하여 중복 시 에러 방지

INSERT IGNORE INTO `resource_template` (`id`, `module_id`, `category`, `file_path`, `file_type`, `description`, `template_content`, `required`, `created_at`, `updated_at`, `deleted_at`) VALUES (1,4,'CONFIG','application.yml','YAML','REST-API 모듈 공통 설정. 환경 무관하게 적용되는 기본값 정의. 환경별 설정은 application-{profile}.yml에서 오버라이드.','# ============================================================\n# REST-API Module - Common Configuration\n# ============================================================\n\nspring:\n  application:\n    name: $${APPLICATION_NAME:rest-api}\n\n  # ─────────────────────────────────────────────────────────\n  # Profile 설정\n  # ─────────────────────────────────────────────────────────\n  profiles:\n    active: $${SPRING_PROFILES_ACTIVE:local}\n\n  # ─────────────────────────────────────────────────────────\n  # Jackson JSON 직렬화 설정\n  # ─────────────────────────────────────────────────────────\n  jackson:\n    # 날짜/시간 형식 (ISO 8601)\n    date-format: yyyy-MM-dd\'T\'HH:mm:ss\n    time-zone: Asia/Seoul\n    # 직렬화 옵션\n    serialization:\n      write-dates-as-timestamps: false\n      fail-on-empty-beans: false\n      indent-output: false\n    # 역직렬화 옵션\n    deserialization:\n      fail-on-unknown-properties: false\n      accept-single-value-as-array: true\n    # NULL 처리\n    default-property-inclusion: non_null\n\n  # ─────────────────────────────────────────────────────────\n  # 국제화 (i18n) 설정\n  # ─────────────────────────────────────────────────────────\n  messages:\n    basename: messages/messages\n    encoding: UTF-8\n    fallback-to-system-locale: false\n    use-code-as-default-message: true\n\n# ─────────────────────────────────────────────────────────\n# 서버 공통 설정\n# ─────────────────────────────────────────────────────────\nserver:\n  # 서블릿 설정\n  servlet:\n    context-path: /api\n    encoding:\n      charset: UTF-8\n      enabled: true\n      force: true\n\n  # 에러 처리 설정\n  error:\n    include-message: always\n    include-binding-errors: always\n    include-stacktrace: never\n    include-exception: false\n    whitelabel:\n      enabled: false\n\n# ─────────────────────────────────────────────────────────\n# Spring MVC 설정\n# ─────────────────────────────────────────────────────────\nspring.mvc:\n  # RFC 7807 Problem Details 활성화\n  problemdetails:\n    enabled: true\n  # 핸들러 없을 시 예외 발생\n  throw-exception-if-no-handler-found: true\n  # 날짜/시간 포맷\n  format:\n    date: yyyy-MM-dd\n    time: HH:mm:ss\n    date-time: yyyy-MM-dd\'T\'HH:mm:ss\n\n# ─────────────────────────────────────────────────────────\n# OpenAPI/Swagger 설정\n# ─────────────────────────────────────────────────────────\nspringdoc:\n  api-docs:\n    path: /v3/api-docs\n    enabled: true\n  swagger-ui:\n    path: /swagger-ui.html\n    enabled: true\n    operations-sorter: method\n    tags-sorter: alpha\n    display-request-duration: true\n  # 기본 응답 타입\n  default-produces-media-type: application/json\n  default-consumes-media-type: application/json\n',1,'2026-01-16 02:26:13','2026-01-16 02:26:13',NULL),(2,4,'CONFIG','application-local.yml','YAML','로컬 개발 환경 설정. 개발 편의성 극대화: 상세 로깅, Swagger 활성화, 빠른 피드백.','# ============================================================\n# REST-API Module - Local Development Configuration\n# ============================================================\n\nserver:\n  port: 8080\n\n  # Tomcat 설정 (개발용 - 가벼운 설정)\n  tomcat:\n    threads:\n      max: 10\n      min-spare: 2\n    accept-count: 10\n    connection-timeout: 5000\n\n# ─────────────────────────────────────────────────────────\n# 로깅 설정 (개발: 상세 로깅)\n# ─────────────────────────────────────────────────────────\nlogging:\n  level:\n    root: INFO\n    # 애플리케이션 로그 - DEBUG\n    com.ryuqq: DEBUG\n    # Spring MVC 요청 매핑 로그\n    org.springframework.web: DEBUG\n    org.springframework.web.servlet.mvc.method.annotation: DEBUG\n    # SQL 로그\n    org.hibernate.SQL: DEBUG\n    org.hibernate.type.descriptor.sql: TRACE\n    # Jackson 직렬화 로그\n    com.fasterxml.jackson: DEBUG\n\n  pattern:\n    console: \"%d{HH:mm:ss.SSS} %clr(%-5level) [%thread] %clr(%logger{36}){cyan} - %msg%n\"\n\n# ─────────────────────────────────────────────────────────\n# 개발 편의 설정\n# ─────────────────────────────────────────────────────────\nspring:\n  # 에러 상세 정보 (개발용)\n  mvc:\n    log-request-details: true\n\n  # DevTools (선택적)\n  devtools:\n    restart:\n      enabled: true\n    livereload:\n      enabled: true\n\n# ─────────────────────────────────────────────────────────\n# Swagger UI 설정 (로컬 전체 활성화)\n# ─────────────────────────────────────────────────────────\nspringdoc:\n  swagger-ui:\n    enabled: true\n    try-it-out-enabled: true\n    filter: true\n    show-extensions: true\n  show-actuator: true\n\n# ─────────────────────────────────────────────────────────\n# Actuator 설정 (개발: 전체 노출)\n# ─────────────────────────────────────────────────────────\nmanagement:\n  endpoints:\n    web:\n      exposure:\n        include: \"*\"\n  endpoint:\n    health:\n      show-details: always\n    env:\n      show-values: always\n',1,'2026-01-16 02:26:13','2026-01-16 02:26:13',NULL),(3,4,'CONFIG','application-dev.yml','YAML','개발 서버 환경 설정. 팀 공유 개발 서버용. 적당한 로깅, Swagger 활성화, 성능보다 디버깅 우선.','# ============================================================\n# REST-API Module - Development Server Configuration\n# ============================================================\n\nserver:\n  port: $${SERVER_PORT:8080}\n\n  # Tomcat 설정 (개발 서버용 - 중간 설정)\n  tomcat:\n    threads:\n      max: 50\n      min-spare: 10\n    accept-count: 50\n    connection-timeout: 10000\n    max-connections: 200\n\n# ─────────────────────────────────────────────────────────\n# 로깅 설정 (개발 서버: INFO + 애플리케이션 DEBUG)\n# ─────────────────────────────────────────────────────────\nlogging:\n  level:\n    root: INFO\n    com.ryuqq: DEBUG\n    org.springframework.web: INFO\n    org.hibernate.SQL: DEBUG\n\n  file:\n    name: $${LOG_PATH:/var/log/app}/rest-api.log\n\n  logback:\n    rollingpolicy:\n      max-file-size: 100MB\n      max-history: 7\n      total-size-cap: 1GB\n\n# ─────────────────────────────────────────────────────────\n# Swagger UI 설정 (개발 서버 활성화)\n# ─────────────────────────────────────────────────────────\nspringdoc:\n  swagger-ui:\n    enabled: true\n  api-docs:\n    enabled: true\n\n# ─────────────────────────────────────────────────────────\n# Actuator 설정 (개발 서버: 제한적 노출)\n# ─────────────────────────────────────────────────────────\nmanagement:\n  endpoints:\n    web:\n      exposure:\n        include: health,info,metrics,loggers\n  endpoint:\n    health:\n      show-details: when_authorized\n',1,'2026-01-16 02:26:13','2026-01-16 02:26:13',NULL),(4,4,'CONFIG','application-staging.yml','YAML','스테이징 환경 설정. 운영 환경과 동일한 설정으로 사전 검증. Swagger 비활성화, 보안 강화.','# ============================================================\n# REST-API Module - Staging Configuration\n# ============================================================\n\nserver:\n  port: $${SERVER_PORT:8080}\n\n  # Tomcat 설정 (운영과 동일)\n  tomcat:\n    threads:\n      max: 200\n      min-spare: 20\n    accept-count: 100\n    connection-timeout: 20000\n    max-connections: 8192\n\n  # Gzip 압축 활성화\n  compression:\n    enabled: true\n    mime-types: application/json,application/xml,text/html,text/xml,text/plain\n    min-response-size: 1024\n\n# ─────────────────────────────────────────────────────────\n# 로깅 설정 (스테이징: INFO 레벨)\n# ─────────────────────────────────────────────────────────\nlogging:\n  level:\n    root: INFO\n    com.ryuqq: INFO\n    org.springframework.web: WARN\n    org.hibernate.SQL: WARN\n\n  file:\n    name: $${LOG_PATH:/var/log/app}/rest-api.log\n\n  logback:\n    rollingpolicy:\n      max-file-size: 200MB\n      max-history: 14\n      total-size-cap: 3GB\n\n# ─────────────────────────────────────────────────────────\n# Swagger UI 설정 (스테이징: 비활성화)\n# ─────────────────────────────────────────────────────────\nspringdoc:\n  swagger-ui:\n    enabled: false\n  api-docs:\n    enabled: false\n\n# ─────────────────────────────────────────────────────────\n# Actuator 설정 (스테이징: 최소 노출)\n# ─────────────────────────────────────────────────────────\nmanagement:\n  endpoints:\n    web:\n      exposure:\n        include: health,info,prometheus\n  endpoint:\n    health:\n      show-details: never\n',1,'2026-01-16 02:26:13','2026-01-16 02:26:13',NULL),(5,4,'CONFIG','application-prod.yml','YAML','운영 환경 설정. 보안 최우선, 성능 최적화, 최소 로깅. Swagger/Actuator 엄격 제한.','# ============================================================\n# REST-API Module - Production Configuration\n# ============================================================\n\nserver:\n  port: $${SERVER_PORT:8080}\n\n  # Tomcat 설정 (운영: 고성능)\n  tomcat:\n    threads:\n      max: 200\n      min-spare: 50\n    accept-count: 100\n    connection-timeout: 20000\n    max-connections: 10000\n    # Keep-Alive 설정\n    keep-alive-timeout: 30000\n    max-keep-alive-requests: 100\n\n  # Gzip 압축 활성화 (성능)\n  compression:\n    enabled: true\n    mime-types: application/json,application/xml,text/html,text/xml,text/plain,application/javascript,text/css\n    min-response-size: 1024\n\n  # 보안 헤더\n  error:\n    include-message: never\n    include-binding-errors: never\n    include-stacktrace: never\n    include-exception: false\n\n# ─────────────────────────────────────────────────────────\n# 로깅 설정 (운영: WARN 이상만)\n# ─────────────────────────────────────────────────────────\nlogging:\n  level:\n    root: WARN\n    com.ryuqq: INFO\n    org.springframework.web: WARN\n    org.hibernate: WARN\n\n  file:\n    name: $${LOG_PATH:/var/log/app}/rest-api.log\n\n  logback:\n    rollingpolicy:\n      max-file-size: 500MB\n      max-history: 30\n      total-size-cap: 10GB\n\n  # JSON 로그 포맷 (로그 수집기 연동)\n  pattern:\n    file: \'{\"timestamp\":\"%d{yyyy-MM-dd\'T\'HH:mm:ss.SSSZ}\",\"level\":\"%level\",\"logger\":\"%logger\",\"message\":\"%msg\",\"thread\":\"%thread\"}%n\'\n\n# ─────────────────────────────────────────────────────────\n# Swagger UI 설정 (운영: 완전 비활성화)\n# ─────────────────────────────────────────────────────────\nspringdoc:\n  swagger-ui:\n    enabled: false\n  api-docs:\n    enabled: false\n\n# ─────────────────────────────────────────────────────────\n# Actuator 설정 (운영: 헬스체크만)\n# ─────────────────────────────────────────────────────────\nmanagement:\n  endpoints:\n    web:\n      exposure:\n        include: health,prometheus\n      base-path: /internal/actuator\n  endpoint:\n    health:\n      show-details: never\n      probes:\n        enabled: true\n  # Prometheus 메트릭\n  prometheus:\n    metrics:\n      export:\n        enabled: true\n\n# ─────────────────────────────────────────────────────────\n# 보안 설정 (운영)\n# ─────────────────────────────────────────────────────────\nspring:\n  # 예외 상세 정보 숨김\n  mvc:\n    log-request-details: false\n',1,'2026-01-16 02:26:14','2026-01-16 02:26:14',NULL),(6,4,'I18N','messages/messages.properties','PROPERTIES','기본 메시지 번들 (영문). 국제화 기본값으로 사용. validation, error, common 메시지 정의.','# ============================================================\n# REST-API Module - Default Messages (English)\n# ============================================================\n\n# ─────────────────────────────────────────────────────────\n# Common Messages\n# ─────────────────────────────────────────────────────────\ncommon.success=Success\ncommon.fail=Failed\ncommon.error=An error occurred\n\n# ─────────────────────────────────────────────────────────\n# Validation Messages (Bean Validation)\n# ─────────────────────────────────────────────────────────\n# Standard constraints\njakarta.validation.constraints.NotNull.message=must not be null\njakarta.validation.constraints.NotEmpty.message=must not be empty\njakarta.validation.constraints.NotBlank.message=must not be blank\njakarta.validation.constraints.Size.message=size must be between {min} and {max}\njakarta.validation.constraints.Min.message=must be greater than or equal to {value}\njakarta.validation.constraints.Max.message=must be less than or equal to {value}\njakarta.validation.constraints.Email.message=must be a valid email address\njakarta.validation.constraints.Pattern.message=must match \"{regexp}\"\njakarta.validation.constraints.Positive.message=must be greater than 0\njakarta.validation.constraints.PositiveOrZero.message=must be greater than or equal to 0\njakarta.validation.constraints.Past.message=must be a past date\njakarta.validation.constraints.Future.message=must be a future date\n\n# ─────────────────────────────────────────────────────────\n# API Error Messages\n# ─────────────────────────────────────────────────────────\n# HTTP Status\nerror.bad-request=Bad request\nerror.unauthorized=Unauthorized access\nerror.forbidden=Access denied\nerror.not-found=Resource not found\nerror.method-not-allowed=Method not allowed\nerror.conflict=Resource conflict\nerror.unprocessable-entity=Unprocessable entity\nerror.internal-server-error=Internal server error\nerror.service-unavailable=Service temporarily unavailable\n\n# Business Errors\nerror.resource.not-found={0} not found with id: {1}\nerror.resource.already-exists={0} already exists\nerror.resource.cannot-delete={0} cannot be deleted\nerror.validation.failed=Validation failed\n\n# ─────────────────────────────────────────────────────────\n# Field Labels (for error messages)\n# ─────────────────────────────────────────────────────────\nfield.id=ID\nfield.name=Name\nfield.email=Email\nfield.password=Password\nfield.phone=Phone number\nfield.address=Address\nfield.createdAt=Created date\nfield.updatedAt=Updated date\n',1,'2026-01-16 02:26:14','2026-01-16 02:26:14',NULL),(7,4,'I18N','messages/messages_ko.properties','PROPERTIES','한국어 메시지 번들. 한국어 사용자를 위한 로컬라이제이션. validation, error, common 메시지 정의.','# ============================================================\n# REST-API Module - Korean Messages\n# ============================================================\n\n# ─────────────────────────────────────────────────────────\n# Common Messages\n# ─────────────────────────────────────────────────────────\ncommon.success=성공\ncommon.fail=실패\ncommon.error=오류가 발생했습니다\n\n# ─────────────────────────────────────────────────────────\n# Validation Messages (Bean Validation)\n# ─────────────────────────────────────────────────────────\n# Standard constraints\njakarta.validation.constraints.NotNull.message=필수 입력값입니다\njakarta.validation.constraints.NotEmpty.message=필수 입력값이며 비어있을 수 없습니다\njakarta.validation.constraints.NotBlank.message=필수 입력값이며 공백일 수 없습니다\njakarta.validation.constraints.Size.message={min}자 이상 {max}자 이하로 입력해주세요\njakarta.validation.constraints.Min.message={value} 이상의 값을 입력해주세요\njakarta.validation.constraints.Max.message={value} 이하의 값을 입력해주세요\njakarta.validation.constraints.Email.message=올바른 이메일 형식이 아닙니다\njakarta.validation.constraints.Pattern.message=올바른 형식이 아닙니다\njakarta.validation.constraints.Positive.message=0보다 큰 값을 입력해주세요\njakarta.validation.constraints.PositiveOrZero.message=0 이상의 값을 입력해주세요\njakarta.validation.constraints.Past.message=과거 날짜를 입력해주세요\njakarta.validation.constraints.Future.message=미래 날짜를 입력해주세요\n\n# ─────────────────────────────────────────────────────────\n# API Error Messages\n# ─────────────────────────────────────────────────────────\n# HTTP Status\nerror.bad-request=잘못된 요청입니다\nerror.unauthorized=인증이 필요합니다\nerror.forbidden=접근 권한이 없습니다\nerror.not-found=요청한 리소스를 찾을 수 없습니다\nerror.method-not-allowed=지원하지 않는 HTTP 메서드입니다\nerror.conflict=리소스 충돌이 발생했습니다\nerror.unprocessable-entity=처리할 수 없는 요청입니다\nerror.internal-server-error=서버 내부 오류가 발생했습니다\nerror.service-unavailable=서비스를 일시적으로 사용할 수 없습니다\n\n# Business Errors\nerror.resource.not-found={0}을(를) 찾을 수 없습니다. ID: {1}\nerror.resource.already-exists={0}이(가) 이미 존재합니다\nerror.resource.cannot-delete={0}을(를) 삭제할 수 없습니다\nerror.validation.failed=입력값 검증에 실패했습니다\n\n# ─────────────────────────────────────────────────────────\n# Field Labels (for error messages)\n# ─────────────────────────────────────────────────────────\nfield.id=아이디\nfield.name=이름\nfield.email=이메일\nfield.password=비밀번호\nfield.phone=전화번호\nfield.address=주소\nfield.createdAt=생성일\nfield.updatedAt=수정일\n',1,'2026-01-16 02:26:14','2026-01-16 02:26:14',NULL),(8,4,'CONFIG','logback-spring.xml','XML','Logback 로깅 설정. 환경별 로그 레벨, 파일 롤링, JSON 포맷 등 상세 설정.','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<configuration scan=\"true\" scanPeriod=\"30 seconds\">\n\n    <!-- ═══════════════════════════════════════════════════════════════ -->\n    <!-- Properties                                                       -->\n    <!-- ═══════════════════════════════════════════════════════════════ -->\n    <property name=\"LOG_PATH\" value=\"$${LOG_PATH:-./logs}\"/>\n    <property name=\"APP_NAME\" value=\"$${spring.application.name:-rest-api}\"/>\n\n    <!-- Console Pattern -->\n    <property name=\"CONSOLE_PATTERN\"\n              value=\"%d{HH:mm:ss.SSS} %clr(%-5level){highlight} [%thread] %clr(%logger{36}){cyan} - %msg%n\"/>\n\n    <!-- File Pattern -->\n    <property name=\"FILE_PATTERN\"\n              value=\"%d{yyyy-MM-dd HH:mm:ss.SSS} %-5level [%thread] %logger{36} - %msg%n\"/>\n\n    <!-- JSON Pattern (for log aggregators) -->\n    <property name=\"JSON_PATTERN\"\n              value=\'{\"@timestamp\":\"%d{yyyy-MM-dd\'T\'HH:mm:ss.SSSZ}\",\"level\":\"%level\",\"logger\":\"%logger\",\"message\":\"%msg\",\"thread\":\"%thread\",\"application\":\"$${APP_NAME}\"}%n\'/>\n\n    <!-- ═══════════════════════════════════════════════════════════════ -->\n    <!-- Appenders                                                        -->\n    <!-- ═══════════════════════════════════════════════════════════════ -->\n\n    <!-- Console Appender -->\n    <appender name=\"CONSOLE\" class=\"ch.qos.logback.core.ConsoleAppender\">\n        <encoder>\n            <pattern>$${CONSOLE_PATTERN}</pattern>\n            <charset>UTF-8</charset>\n        </encoder>\n    </appender>\n\n    <!-- File Appender (Rolling) -->\n    <appender name=\"FILE\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\">\n        <file>$${LOG_PATH}/$${APP_NAME}.log</file>\n        <encoder>\n            <pattern>$${FILE_PATTERN}</pattern>\n            <charset>UTF-8</charset>\n        </encoder>\n        <rollingPolicy class=\"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy\">\n            <fileNamePattern>$${LOG_PATH}/$${APP_NAME}.%d{yyyy-MM-dd}.%i.log.gz</fileNamePattern>\n            <maxFileSize>100MB</maxFileSize>\n            <maxHistory>30</maxHistory>\n            <totalSizeCap>3GB</totalSizeCap>\n        </rollingPolicy>\n    </appender>\n\n    <!-- JSON File Appender (for production log aggregation) -->\n    <appender name=\"JSON_FILE\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\">\n        <file>$${LOG_PATH}/$${APP_NAME}-json.log</file>\n        <encoder>\n            <pattern>$${JSON_PATTERN}</pattern>\n            <charset>UTF-8</charset>\n        </encoder>\n        <rollingPolicy class=\"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy\">\n            <fileNamePattern>$${LOG_PATH}/$${APP_NAME}-json.%d{yyyy-MM-dd}.%i.log.gz</fileNamePattern>\n            <maxFileSize>200MB</maxFileSize>\n            <maxHistory>7</maxHistory>\n            <totalSizeCap>5GB</totalSizeCap>\n        </rollingPolicy>\n    </appender>\n\n    <!-- ═══════════════════════════════════════════════════════════════ -->\n    <!-- Profile-specific Configuration                                   -->\n    <!-- ═══════════════════════════════════════════════════════════════ -->\n\n    <!-- Local Profile -->\n    <springProfile name=\"local\">\n        <root level=\"INFO\">\n            <appender-ref ref=\"CONSOLE\"/>\n        </root>\n        <logger name=\"com.ryuqq\" level=\"DEBUG\"/>\n        <logger name=\"org.springframework.web\" level=\"DEBUG\"/>\n        <logger name=\"org.hibernate.SQL\" level=\"DEBUG\"/>\n    </springProfile>\n\n    <!-- Development Profile -->\n    <springProfile name=\"dev\">\n        <root level=\"INFO\">\n            <appender-ref ref=\"CONSOLE\"/>\n            <appender-ref ref=\"FILE\"/>\n        </root>\n        <logger name=\"com.ryuqq\" level=\"DEBUG\"/>\n        <logger name=\"org.hibernate.SQL\" level=\"DEBUG\"/>\n    </springProfile>\n\n    <!-- Staging Profile -->\n    <springProfile name=\"staging\">\n        <root level=\"INFO\">\n            <appender-ref ref=\"FILE\"/>\n            <appender-ref ref=\"JSON_FILE\"/>\n        </root>\n        <logger name=\"com.ryuqq\" level=\"INFO\"/>\n    </springProfile>\n\n    <!-- Production Profile -->\n    <springProfile name=\"prod\">\n        <root level=\"WARN\">\n            <appender-ref ref=\"JSON_FILE\"/>\n        </root>\n        <logger name=\"com.ryuqq\" level=\"INFO\"/>\n    </springProfile>\n\n</configuration>',0,'2026-01-16 02:26:14','2026-01-16 02:26:14',NULL),(9,4,'STATIC','banner.txt','TEXT','Spring Boot 시작 배너. 애플리케이션 이름, 버전, 환경 정보 표시.','\n  ____  _____ ____ _____      _    ____ ___\n |  _ | ____/ ___|_   _|    /   |  _ \\_ _|\n | |_) |  _| \\___  | |     / _  | |_) | |\n |  _ <| |___ ___) || |    / ___ |  __/| |\n |_| \\_\\_____|____/ |_|   /_/   \\_\\_|  |___|\n\n :: $${spring.application.name} :: v$${application.version:1.0.0}\n :: Spring Boot $${spring-boot.version}\n :: Profile: $${spring.profiles.active:default}\n :: Java $${java.version}\n',0,'2026-01-16 02:26:14','2026-01-16 02:26:14',NULL),(10,6,'CONFIG','persistence.yml','YAML','Persistence 모듈 공통 설정. DataSource, JPA, Hibernate 기본값 정의. 환경별 설정은 persistence-{profile}.yml에서 오버라이드.','# ============================================================\n# Persistence Module - Common Configuration\n# MySQL + HikariCP + JPA/Hibernate + QueryDSL\n# ============================================================\n\nspring:\n  # ─────────────────────────────────────────────────────────\n  # DataSource 공통 설정\n  # ─────────────────────────────────────────────────────────\n  datasource:\n    driver-class-name: com.mysql.cj.jdbc.Driver\n\n    # HikariCP 공통 설정 (환경별로 오버라이드)\n    hikari:\n      # 풀 이름 (모니터링 식별용)\n      pool-name: $${HIKARI_POOL_NAME:HikariPool-Persistence}\n\n      # 커넥션 자동 커밋 (JPA 트랜잭션 사용 시 false 권장)\n      auto-commit: false\n\n      # 읽기 전용 여부 (기본값)\n      read-only: false\n\n      # 커넥션 카탈로그 (MySQL 데이터베이스 이름)\n      catalog: $${DB_NAME:app}\n\n      # 트랜잭션 격리 수준 (기본값: REPEATABLE_READ for MySQL)\n      transaction-isolation: TRANSACTION_REPEATABLE_READ\n\n      # 커넥션 초기화 SQL (MySQL 세션 설정)\n      connection-init-sql: |\n        SET NAMES utf8mb4 COLLATE utf8mb4_unicode_ci;\n        SET time_zone = \'+09:00\';\n        SET SESSION sql_mode = \'STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION\';\n\n      # 데이터소스 속성 (MySQL JDBC 드라이버 설정)\n      data-source-properties:\n        # PreparedStatement 캐싱\n        cachePrepStmts: true\n        prepStmtCacheSize: 250\n        prepStmtCacheSqlLimit: 2048\n        useServerPrepStmts: true\n\n        # 배치 처리 최적화\n        rewriteBatchedStatements: true\n\n        # 메타데이터 캐싱\n        cacheResultSetMetadata: true\n        cacheServerConfiguration: true\n\n        # 기타 성능 최적화\n        elideSetAutoCommits: true\n        maintainTimeStats: false\n        useLocalSessionState: true\n        useLocalTransactionState: true\n\n  # ─────────────────────────────────────────────────────────\n  # JPA 공통 설정\n  # ─────────────────────────────────────────────────────────\n  jpa:\n    # Hibernate 구현체 사용\n    database-platform: org.hibernate.dialect.MySQLDialect\n\n    # DDL 자동 생성 (운영에서는 반드시 none)\n    hibernate:\n      ddl-auto: $${JPA_DDL_AUTO:none}\n\n    # 지연 로딩 시 세션 열기 (권장하지 않음 - 명시적 fetch 사용)\n    open-in-view: false\n\n    # JPA 속성\n    properties:\n      hibernate:\n        # ─────────────────────────────────────────────────\n        # Dialect 설정\n        # ─────────────────────────────────────────────────\n        dialect: org.hibernate.dialect.MySQLDialect\n\n        # ─────────────────────────────────────────────────\n        # 배치 처리 설정 (벌크 INSERT/UPDATE 최적화)\n        # ─────────────────────────────────────────────────\n        jdbc:\n          batch_size: 50\n          batch_versioned_data: true\n          fetch_size: 100\n        order_inserts: true\n        order_updates: true\n\n        # ─────────────────────────────────────────────────\n        # 식별자 생성 최적화 (MySQL AUTO_INCREMENT)\n        # ─────────────────────────────────────────────────\n        id:\n          new_generator_mappings: true\n          optimizer:\n            pooled:\n              preferred: pooled-lo\n\n        # ─────────────────────────────────────────────────\n        # 2차 캐시 설정 (비활성화 - 필요 시 Redis 사용)\n        # ─────────────────────────────────────────────────\n        cache:\n          use_second_level_cache: false\n          use_query_cache: false\n\n        # ─────────────────────────────────────────────────\n        # 연결 관리\n        # ─────────────────────────────────────────────────\n        connection:\n          provider_disables_autocommit: true\n\n        # ─────────────────────────────────────────────────\n        # 통계 및 로깅 (기본 비활성화)\n        # ─────────────────────────────────────────────────\n        generate_statistics: false\n        session:\n          events:\n            log:\n              LOG_QUERIES_SLOWER_THAN_MS: 0\n\n  # ─────────────────────────────────────────────────────────\n  # Flyway 공통 설정\n  # ─────────────────────────────────────────────────────────\n  flyway:\n    # Flyway 활성화\n    enabled: $${FLYWAY_ENABLED:true}\n\n    # 마이그레이션 위치\n    locations: classpath:db/migration\n\n    # 기본 스키마\n    default-schema: $${DB_NAME:app}\n\n    # 마이그레이션 테이블 이름\n    table: flyway_schema_history\n\n    # 기준선 설정 (기존 DB에 Flyway 적용 시)\n    baseline-on-migrate: false\n    baseline-version: \'1\'\n\n    # 검증 설정\n    validate-on-migrate: true\n\n    # 클린 금지 (운영 보호)\n    clean-disabled: true\n\n    # 순서 외 마이그레이션 허용 (팀 협업 시)\n    out-of-order: false\n\n    # 인코딩\n    encoding: UTF-8\n\n    # 플레이스홀더\n    placeholder-replacement: true\n',1,'2026-01-16 06:52:08','2026-01-16 06:52:08',NULL),(11,6,'CONFIG','persistence-local.yml','YAML','로컬 개발 환경 설정. Docker MySQL 또는 로컬 MySQL 연결. 상세 SQL 로깅, 작은 커넥션 풀.','# ============================================================\n# Persistence Module - Local Development Configuration\n# ============================================================\n\nspring:\n  # ─────────────────────────────────────────────────────────\n  # DataSource 설정 (로컬 MySQL)\n  # ─────────────────────────────────────────────────────────\n  datasource:\n    url: jdbc:mysql://localhost:3306/$${DB_NAME:app}?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=Asia/Seoul&characterEncoding=UTF-8&useUnicode=true&rewriteBatchedStatements=true&cachePrepStmts=true&useServerPrepStmts=true\n    username: $${DB_USERNAME:root}\n    password: $${DB_PASSWORD:root}\n\n    # ─────────────────────────────────────────────────────\n    # HikariCP 설정 (로컬: 최소 설정)\n    # ─────────────────────────────────────────────────────\n    hikari:\n      # 풀 크기 (로컬: 작게)\n      maximum-pool-size: 5\n      minimum-idle: 2\n\n      # 타임아웃 (로컬: 짧게)\n      connection-timeout: 5000        # 커넥션 획득 대기 최대 5초\n      idle-timeout: 300000            # 유휴 커넥션 유지 5분\n      max-lifetime: 600000            # 커넥션 최대 수명 10분\n      validation-timeout: 3000        # 커넥션 유효성 검사 3초\n\n      # 커넥션 테스트 (MySQL 전용)\n      connection-test-query: SELECT 1\n\n      # 커넥션 누수 감지 (개발 시 유용)\n      leak-detection-threshold: 30000  # 30초 이상 반환 안 되면 경고\n\n  # ─────────────────────────────────────────────────────────\n  # JPA 설정 (로컬: DDL 자동 검증)\n  # ─────────────────────────────────────────────────────────\n  jpa:\n    hibernate:\n      ddl-auto: validate    # 스키마 검증만 (Flyway로 관리)\n\n    # SQL 로깅 (개발 편의)\n    show-sql: true\n\n    properties:\n      hibernate:\n        # SQL 포맷팅\n        format_sql: true\n        use_sql_comments: true\n        highlight_sql: true\n\n        # 통계 수집 (개발 시 성능 분석)\n        generate_statistics: true\n\n        # 느린 쿼리 로깅 (100ms 이상)\n        session:\n          events:\n            log:\n              LOG_QUERIES_SLOWER_THAN_MS: 100\n\n  # ─────────────────────────────────────────────────────────\n  # Flyway 설정 (로컬)\n  # ─────────────────────────────────────────────────────────\n  flyway:\n    enabled: true\n    clean-disabled: false    # 로컬에서는 clean 허용\n    baseline-on-migrate: true\n\n# ─────────────────────────────────────────────────────────\n# 로깅 설정 (로컬: 상세 SQL 로깅)\n# ─────────────────────────────────────────────────────────\nlogging:\n  level:\n    # Hibernate SQL 로깅\n    org.hibernate.SQL: DEBUG\n    org.hibernate.type.descriptor.sql.BasicBinder: TRACE\n    org.hibernate.orm.jdbc.bind: TRACE\n\n    # HikariCP 로깅\n    com.zaxxer.hikari: DEBUG\n    com.zaxxer.hikari.HikariConfig: DEBUG\n\n    # Spring Data JPA\n    org.springframework.data.jpa: DEBUG\n\n    # QueryDSL\n    com.querydsl: DEBUG\n\n    # Flyway\n    org.flywaydb: DEBUG\n',1,'2026-01-16 06:52:08','2026-01-16 06:52:08',NULL),(12,6,'CONFIG','persistence-dev.yml','YAML','개발 서버 환경 설정. 팀 공유 개발 DB 연결. 적당한 커넥션 풀, SQL 로깅 활성화.','# ============================================================\n# Persistence Module - Development Server Configuration\n# ============================================================\n\nspring:\n  # ─────────────────────────────────────────────────────────\n  # DataSource 설정 (개발 서버 MySQL)\n  # ─────────────────────────────────────────────────────────\n  datasource:\n    url: jdbc:mysql://$${DB_HOST:dev-mysql.internal}:$${DB_PORT:3306}/$${DB_NAME:app}?useSSL=true&requireSSL=true&verifyServerCertificate=false&serverTimezone=Asia/Seoul&characterEncoding=UTF-8&useUnicode=true&rewriteBatchedStatements=true&cachePrepStmts=true&useServerPrepStmts=true&connectTimeout=5000&socketTimeout=30000\n    username: $${DB_USERNAME}\n    password: $${DB_PASSWORD}\n\n    # ─────────────────────────────────────────────────────\n    # HikariCP 설정 (개발 서버: 중간 설정)\n    # ─────────────────────────────────────────────────────\n    hikari:\n      # 풀 크기 (개발: 중간)\n      maximum-pool-size: 10\n      minimum-idle: 5\n\n      # 타임아웃\n      connection-timeout: 10000       # 커넥션 획득 대기 최대 10초\n      idle-timeout: 600000            # 유휴 커넥션 유지 10분\n      max-lifetime: 1800000           # 커넥션 최대 수명 30분\n      validation-timeout: 5000        # 커넥션 유효성 검사 5초\n\n      # 커넥션 테스트\n      connection-test-query: SELECT 1\n\n      # 커넥션 누수 감지\n      leak-detection-threshold: 60000  # 60초 이상 반환 안 되면 경고\n\n      # 초기화 실패 타임아웃\n      initialization-fail-timeout: 30000\n\n  # ─────────────────────────────────────────────────────────\n  # JPA 설정 (개발 서버)\n  # ─────────────────────────────────────────────────────────\n  jpa:\n    hibernate:\n      ddl-auto: validate\n\n    show-sql: false    # 파일 로깅으로 대체\n\n    properties:\n      hibernate:\n        format_sql: true\n        generate_statistics: true\n\n        session:\n          events:\n            log:\n              LOG_QUERIES_SLOWER_THAN_MS: 500\n\n  # ─────────────────────────────────────────────────────────\n  # Flyway 설정 (개발 서버)\n  # ─────────────────────────────────────────────────────────\n  flyway:\n    enabled: true\n    clean-disabled: true    # 개발 서버에서도 clean 금지\n    out-of-order: true      # 팀 협업으로 순서 외 마이그레이션 허용\n\n# ─────────────────────────────────────────────────────────\n# 로깅 설정 (개발 서버: SQL 로깅)\n# ─────────────────────────────────────────────────────────\nlogging:\n  level:\n    org.hibernate.SQL: DEBUG\n    org.hibernate.orm.jdbc.bind: DEBUG\n    com.zaxxer.hikari: INFO\n    org.flywaydb: INFO\n',1,'2026-01-16 06:52:08','2026-01-16 06:52:08',NULL),(13,6,'CONFIG','persistence-staging.yml','YAML','스테이징 환경 설정. 운영과 유사한 설정으로 사전 검증. SQL 로깅 최소화, 운영급 커넥션 풀.','# ============================================================\n# Persistence Module - Staging Configuration\n# ============================================================\n\nspring:\n  # ─────────────────────────────────────────────────────────\n  # DataSource 설정 (스테이징 MySQL)\n  # ─────────────────────────────────────────────────────────\n  datasource:\n    url: jdbc:mysql://$${DB_HOST}:$${DB_PORT:3306}/$${DB_NAME}?useSSL=true&requireSSL=true&verifyServerCertificate=true&serverTimezone=Asia/Seoul&characterEncoding=UTF-8&useUnicode=true&rewriteBatchedStatements=true&cachePrepStmts=true&useServerPrepStmts=true&connectTimeout=5000&socketTimeout=60000\n    username: $${DB_USERNAME}\n    password: $${DB_PASSWORD}\n\n    # ─────────────────────────────────────────────────────\n    # HikariCP 설정 (스테이징: 운영과 유사)\n    # ─────────────────────────────────────────────────────\n    hikari:\n      # 풀 크기 (운영의 절반 수준)\n      maximum-pool-size: 15\n      minimum-idle: 10\n\n      # 타임아웃 (운영과 동일)\n      connection-timeout: 30000       # 커넥션 획득 대기 최대 30초\n      idle-timeout: 600000            # 유휴 커넥션 유지 10분\n      max-lifetime: 1800000           # 커넥션 최대 수명 30분\n      validation-timeout: 5000        # 커넥션 유효성 검사 5초\n      keepalive-time: 300000          # Keep-alive 5분\n\n      # 커넥션 테스트\n      connection-test-query: SELECT 1\n\n      # 커넥션 누수 감지 (스테이징에서 검증)\n      leak-detection-threshold: 120000  # 2분\n\n      # 초기화 실패 타임아웃\n      initialization-fail-timeout: 60000\n\n  # ─────────────────────────────────────────────────────────\n  # JPA 설정 (스테이징)\n  # ─────────────────────────────────────────────────────────\n  jpa:\n    hibernate:\n      ddl-auto: validate\n\n    show-sql: false\n\n    properties:\n      hibernate:\n        format_sql: false\n        generate_statistics: false\n\n        # 느린 쿼리만 로깅 (1초 이상)\n        session:\n          events:\n            log:\n              LOG_QUERIES_SLOWER_THAN_MS: 1000\n\n  # ─────────────────────────────────────────────────────────\n  # Flyway 설정 (스테이징)\n  # ─────────────────────────────────────────────────────────\n  flyway:\n    enabled: true\n    clean-disabled: true\n    validate-on-migrate: true\n\n# ─────────────────────────────────────────────────────────\n# 로깅 설정 (스테이징: 최소 로깅)\n# ─────────────────────────────────────────────────────────\nlogging:\n  level:\n    org.hibernate.SQL: WARN\n    org.hibernate.orm.jdbc.bind: WARN\n    com.zaxxer.hikari: WARN\n    org.flywaydb: INFO\n',1,'2026-01-16 06:52:08','2026-01-16 06:52:08',NULL),(14,6,'CONFIG','persistence-prod.yml','YAML','운영 환경 설정. 보안 최우선, 성능 최적화, 고가용성. HikariCP 풀 최적화, SSL 필수.','# ============================================================\n# Persistence Module - Production Configuration\n# ============================================================\n\nspring:\n  # ─────────────────────────────────────────────────────────\n  # DataSource 설정 (운영 MySQL - AWS RDS/Aurora 등)\n  # ─────────────────────────────────────────────────────────\n  datasource:\n    # AWS RDS MySQL 예시 (Aurora, RDS 모두 적용 가능)\n    url: jdbc:mysql://$${DB_HOST}:$${DB_PORT:3306}/$${DB_NAME}?useSSL=true&requireSSL=true&verifyServerCertificate=true&enabledTLSProtocols=TLSv1.2,TLSv1.3&serverTimezone=Asia/Seoul&characterEncoding=UTF-8&useUnicode=true&rewriteBatchedStatements=true&cachePrepStmts=true&prepStmtCacheSize=500&prepStmtCacheSqlLimit=4096&useServerPrepStmts=true&connectTimeout=5000&socketTimeout=60000&tcpKeepAlive=true\n    username: $${DB_USERNAME}\n    password: $${DB_PASSWORD}\n\n    # ─────────────────────────────────────────────────────\n    # HikariCP 설정 (운영: 고성능 최적화)\n    # ─────────────────────────────────────────────────────\n    hikari:\n      pool-name: HikariPool-Production\n\n      # ─────────────────────────────────────────────────\n      # 풀 크기 설정\n      # 공식: connections = ((core_count * 2) + effective_spindle_count)\n      # 일반적으로 CPU 코어 수 * 2 ~ 4\n      # ─────────────────────────────────────────────────\n      maximum-pool-size: $${HIKARI_MAX_POOL_SIZE:30}\n      minimum-idle: $${HIKARI_MIN_IDLE:15}\n\n      # ─────────────────────────────────────────────────\n      # 타임아웃 설정 (운영: 안정성 중시)\n      # ─────────────────────────────────────────────────\n\n      # 커넥션 획득 대기 최대 시간 (30초)\n      # 이 시간 내에 커넥션을 얻지 못하면 SQLException 발생\n      connection-timeout: 30000\n\n      # 유휴 커넥션 유지 시간 (10분)\n      # minimum-idle보다 많은 유휴 커넥션은 이 시간 후 제거\n      idle-timeout: 600000\n\n      # 커넥션 최대 수명 (30분)\n      # DB의 wait_timeout보다 짧아야 함 (MySQL 기본 8시간)\n      # 커넥션 재활용으로 메모리 누수 방지\n      max-lifetime: 1800000\n\n      # 커넥션 유효성 검사 타임아웃 (5초)\n      validation-timeout: 5000\n\n      # Keep-Alive 간격 (5분)\n      # 유휴 커넥션이 DB에 의해 끊기지 않도록 유지\n      keepalive-time: 300000\n\n      # ─────────────────────────────────────────────────\n      # 커넥션 검증\n      # ─────────────────────────────────────────────────\n\n      # MySQL 커넥션 테스트 쿼리\n      # JDBC4 드라이버는 isValid() 사용, 설정하지 않아도 됨\n      # 하지만 명시적으로 설정하면 더 확실함\n      connection-test-query: SELECT 1\n\n      # ─────────────────────────────────────────────────\n      # 초기화 설정\n      # ─────────────────────────────────────────────────\n\n      # 초기화 실패 시 즉시 예외 발생 (fail-fast)\n      # 0보다 크면 해당 시간만큼 재시도\n      initialization-fail-timeout: 1\n\n      # ─────────────────────────────────────────────────\n      # 커넥션 누수 감지 (운영에서는 비활성화 또는 높은 값)\n      # 운영에서 오탐 방지를 위해 높은 임계값 또는 비활성화\n      # ─────────────────────────────────────────────────\n      leak-detection-threshold: 0    # 비활성화 (0)\n\n      # ─────────────────────────────────────────────────\n      # 기타 최적화 설정\n      # ─────────────────────────────────────────────────\n      auto-commit: false\n      read-only: false\n\n      # MySQL 드라이버 최적화 속성\n      data-source-properties:\n        # PreparedStatement 캐싱 (성능 향상)\n        cachePrepStmts: true\n        prepStmtCacheSize: 500\n        prepStmtCacheSqlLimit: 4096\n        useServerPrepStmts: true\n\n        # 배치 처리 최적화\n        rewriteBatchedStatements: true\n\n        # 메타데이터 캐싱\n        cacheResultSetMetadata: true\n        cacheServerConfiguration: true\n        elideSetAutoCommits: true\n\n        # 네트워크 최적화\n        tcpKeepAlive: true\n        tcpNoDelay: true\n\n        # 로깅 비활성화 (성능)\n        maintainTimeStats: false\n        enableQueryTimeouts: true\n\n  # ─────────────────────────────────────────────────────────\n  # JPA 설정 (운영)\n  # ─────────────────────────────────────────────────────────\n  jpa:\n    hibernate:\n      ddl-auto: none    # 절대 자동 DDL 금지\n\n    show-sql: false\n    open-in-view: false\n\n    properties:\n      hibernate:\n        format_sql: false\n        use_sql_comments: false\n        generate_statistics: false\n\n        # 배치 처리 (운영: 큰 배치)\n        jdbc:\n          batch_size: 100\n          fetch_size: 200\n\n        # 캐시 비활성화 (Redis로 대체)\n        cache:\n          use_second_level_cache: false\n          use_query_cache: false\n\n        # 느린 쿼리 로깅 비활성화 (APM 도구로 대체)\n        session:\n          events:\n            log:\n              LOG_QUERIES_SLOWER_THAN_MS: 0\n\n  # ─────────────────────────────────────────────────────────\n  # Flyway 설정 (운영)\n  # ─────────────────────────────────────────────────────────\n  flyway:\n    enabled: $${FLYWAY_ENABLED:true}\n    clean-disabled: true    # 절대 clean 금지\n    validate-on-migrate: true\n    out-of-order: false     # 순서 엄격 적용\n\n# ─────────────────────────────────────────────────────────\n# 로깅 설정 (운영: 에러만)\n# ─────────────────────────────────────────────────────────\nlogging:\n  level:\n    org.hibernate: WARN\n    org.hibernate.SQL: WARN\n    org.hibernate.orm.jdbc.bind: OFF\n    com.zaxxer.hikari: WARN\n    org.flywaydb: WARN\n',1,'2026-01-16 06:52:08','2026-01-16 06:52:08',NULL),(15,6,'CONFIG','config/JpaConfig.java','JAVA','JPA 설정 클래스. JPA Auditing, EntityManager, TransactionManager 설정.','package com.{bc}.adapter.out.persistence.config;\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.domain.AuditorAware;\nimport org.springframework.data.jpa.repository.config.EnableJpaAuditing;\nimport org.springframework.data.jpa.repository.config.EnableJpaRepositories;\nimport org.springframework.transaction.annotation.EnableTransactionManagement;\n\nimport java.util.Optional;\n\n/**\n * JPA 설정 클래스\n *\n * <p>기능:</p>\n * <ul>\n *   <li>JPA Auditing 활성화 (@CreatedDate, @LastModifiedDate)</li>\n *   <li>JPA Repository 스캔 경로 지정</li>\n *   <li>트랜잭션 관리 활성화</li>\n * </ul>\n *\n * <p>주의사항:</p>\n * <ul>\n *   <li>auditorProvider는 보안 컨텍스트에서 사용자 ID를 가져오도록 구현</li>\n *   <li>멀티 모듈 프로젝트에서는 basePackages 명시 필수</li>\n * </ul>\n */\n@Configuration\n@EnableJpaAuditing(auditorAwareRef = \"auditorProvider\")\n@EnableJpaRepositories(\n    basePackages = \"com.{bc}.adapter.out.persistence\",\n    // EntityManager 지정 (멀티 DataSource 시)\n    entityManagerFactoryRef = \"entityManagerFactory\",\n    transactionManagerRef = \"transactionManager\"\n)\n@EnableTransactionManagement\npublic class JpaConfig {\n\n    /**\n     * Auditor Provider - 현재 사용자 ID 제공\n     *\n     * <p>@CreatedBy, @LastModifiedBy 필드에 사용자 ID 자동 주입</p>\n     *\n     * <p>구현 방법:</p>\n     * <ul>\n     *   <li>Spring Security: SecurityContextHolder에서 가져오기</li>\n     *   <li>JWT: 토큰에서 사용자 ID 추출</li>\n     *   <li>시스템 작업: \"SYSTEM\" 또는 고정값 반환</li>\n     * </ul>\n     *\n     * @return AuditorAware 구현체\n     */\n    @Bean\n    public AuditorAware<String> auditorProvider() {\n        // 기본 구현: 시스템 사용자\n        // TODO: 실제 구현 시 SecurityContext에서 사용자 ID 추출\n        return () -> Optional.of(\"SYSTEM\");\n\n        // Spring Security 사용 시 예시:\n        // return () -> Optional.ofNullable(SecurityContextHolder.getContext())\n        //     .map(SecurityContext::getAuthentication)\n        //     .filter(Authentication::isAuthenticated)\n        //     .map(Authentication::getName);\n    }\n}',1,'2026-01-16 06:52:08','2026-01-16 06:52:08',NULL),(16,6,'CONFIG','config/QueryDslConfig.java','JAVA','QueryDSL 설정 클래스. JPAQueryFactory Bean 등록.','package com.{bc}.adapter.out.persistence.config;\n\nimport com.querydsl.jpa.impl.JPAQueryFactory;\nimport jakarta.persistence.EntityManager;\nimport jakarta.persistence.PersistenceContext;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\n/**\n * QueryDSL 설정 클래스\n *\n * <p>JPAQueryFactory Bean을 등록하여 QueryDslRepository에서 사용</p>\n *\n * <p>사용 예시:</p>\n * <pre>{@code\n * @Repository\n * public class OrderQueryDslRepository {\n *\n *     private final JPAQueryFactory queryFactory;\n *\n *     public OrderQueryDslRepository(JPAQueryFactory queryFactory) {\n *         this.queryFactory = queryFactory;\n *     }\n *\n *     public List<OrderJpaEntity> findByStatus(OrderStatus status) {\n *         return queryFactory\n *             .selectFrom(order)\n *             .where(order.status.eq(status))\n *             .fetch();\n *     }\n * }\n * }</pre>\n *\n * <p>주의사항:</p>\n * <ul>\n *   <li>EntityManager는 요청 스코프이므로 Thread-Safe</li>\n *   <li>JPAQueryFactory는 Singleton Bean으로 등록해도 안전</li>\n *   <li>멀티 DataSource 환경에서는 EntityManager 구분 필요</li>\n * </ul>\n */\n@Configuration\npublic class QueryDslConfig {\n\n    @PersistenceContext\n    private EntityManager entityManager;\n\n    /**\n     * JPAQueryFactory Bean 등록\n     *\n     * <p>QueryDSL의 타입 안전한 쿼리 빌더</p>\n     *\n     * @return JPAQueryFactory 인스턴스\n     */\n    @Bean\n    public JPAQueryFactory jpaQueryFactory() {\n        return new JPAQueryFactory(entityManager);\n    }\n}',1,'2026-01-16 06:52:08','2026-01-16 06:52:08',NULL),(17,6,'CONFIG','config/P6SpyConfig.java','JAVA','P6Spy SQL 로깅 설정 (선택적). 바인딩 파라미터 포함 실제 SQL 출력.','package com.{bc}.adapter.out.persistence.config;\n\nimport com.p6spy.engine.logging.Category;\nimport com.p6spy.engine.spy.P6SpyOptions;\nimport com.p6spy.engine.spy.appender.MessageFormattingStrategy;\nimport jakarta.annotation.PostConstruct;\nimport org.hibernate.engine.jdbc.internal.FormatStyle;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.context.annotation.Profile;\n\nimport java.util.Locale;\n\n/**\n * P6Spy SQL 로깅 설정 (선택적)\n *\n * <p>실제 바인딩된 파라미터 값을 포함한 SQL 출력</p>\n *\n * <p>활성화 조건:</p>\n * <ul>\n *   <li>local, dev 프로파일에서만 활성화</li>\n *   <li>운영 환경에서는 비활성화 (성능 영향)</li>\n * </ul>\n *\n * <p>의존성 추가 필요:</p>\n * <pre>{@code\n * implementation \'com.github.gavlyukovskiy:p6spy-spring-boot-starter:1.9.0\'\n * }</pre>\n *\n * <p>application.yml 설정:</p>\n * <pre>{@code\n * decorator:\n *   datasource:\n *     p6spy:\n *       enable-logging: true\n *       multiline: true\n *       logging: slf4j\n * }</pre>\n */\n@Configuration\n@Profile({\"local\", \"dev\"})\npublic class P6SpyConfig {\n\n    @PostConstruct\n    public void setLogMessageFormat() {\n        P6SpyOptions.getActiveInstance().setLogMessageFormat(P6SpySqlFormatStrategy.class.getName());\n    }\n\n    /**\n     * SQL 포맷팅 전략\n     */\n    public static class P6SpySqlFormatStrategy implements MessageFormattingStrategy {\n\n        @Override\n        public String formatMessage(int connectionId, String now, long elapsed,\n                                    String category, String prepared, String sql, String url) {\n            if (sql == null || sql.trim().isEmpty()) {\n                return \"\";\n            }\n\n            String formattedSql = formatSql(category, sql);\n\n            return String.format(\n                \"\n============================================================\n\" +\n                \"  Connection ID: %d\n\" +\n                \"  Execution Time: %d ms\n\" +\n                \"  Category: %s\n\" +\n                \"============================================================\n\" +\n                \"%s\n\" +\n                \"============================================================\",\n                connectionId, elapsed, category, formattedSql\n            );\n        }\n\n        private String formatSql(String category, String sql) {\n            if (sql == null || sql.trim().isEmpty()) {\n                return sql;\n            }\n\n            // DDL과 DML 구분하여 포맷팅\n            if (Category.STATEMENT.getName().equals(category)) {\n                String trimmedSql = sql.trim().toLowerCase(Locale.ROOT);\n                if (trimmedSql.startsWith(\"create\") ||\n                    trimmedSql.startsWith(\"alter\") ||\n                    trimmedSql.startsWith(\"drop\") ||\n                    trimmedSql.startsWith(\"comment\")) {\n                    return FormatStyle.DDL.getFormatter().format(sql);\n                }\n                return FormatStyle.BASIC.getFormatter().format(sql);\n            }\n            return sql;\n        }\n    }\n}',0,'2026-01-16 06:52:08','2026-01-16 06:52:08',NULL),(18,6,'CONFIG','entity/common/BaseAuditEntity.java','JAVA','JPA Auditing 기반 추상 엔티티. createdAt, updatedAt 자동 관리.','package com.{bc}.adapter.out.persistence.entity.common;\n\nimport jakarta.persistence.Column;\nimport jakarta.persistence.EntityListeners;\nimport jakarta.persistence.MappedSuperclass;\nimport org.springframework.data.annotation.CreatedDate;\nimport org.springframework.data.annotation.LastModifiedDate;\nimport org.springframework.data.jpa.domain.support.AuditingEntityListener;\n\nimport java.time.Instant;\n\n/**\n * 감사 기반 추상 엔티티\n *\n * <p>모든 Entity가 상속받아야 하는 기본 클래스</p>\n *\n * <p>제공 기능:</p>\n * <ul>\n *   <li>createdAt: 생성 시각 (INSERT 시 자동 설정, 변경 불가)</li>\n *   <li>updatedAt: 수정 시각 (UPDATE 시 자동 갱신)</li>\n * </ul>\n *\n * <p>주의사항:</p>\n * <ul>\n *   <li>@EnableJpaAuditing 설정 필수</li>\n *   <li>Instant 타입 사용 (타임존 독립적)</li>\n *   <li>Setter 미제공 (JPA Auditing이 자동 설정)</li>\n * </ul>\n *\n * <p>사용 예시:</p>\n * <pre>{@code\n * @Entity\n * @Table(name = \"orders\")\n * public class OrderJpaEntity extends BaseAuditEntity {\n *     // Entity 필드 정의\n * }\n * }</pre>\n */\n@MappedSuperclass\n@EntityListeners(AuditingEntityListener.class)\npublic abstract class BaseAuditEntity {\n\n    @CreatedDate\n    @Column(name = \"created_at\", nullable = false, updatable = false)\n    private Instant createdAt;\n\n    @LastModifiedDate\n    @Column(name = \"updated_at\", nullable = false)\n    private Instant updatedAt;\n\n    // Getter만 제공 (Setter 금지 - Auditing이 자동 설정)\n    public Instant getCreatedAt() {\n        return createdAt;\n    }\n\n    public Instant getUpdatedAt() {\n        return updatedAt;\n    }\n}',1,'2026-01-16 06:52:08','2026-01-16 06:52:08',NULL),(19,6,'CONFIG','entity/common/SoftDeletableEntity.java','JAVA','소프트 삭제 기반 추상 엔티티. deleted, deletedAt 필드 제공.','package com.{bc}.adapter.out.persistence.entity.common;\n\nimport jakarta.persistence.Column;\nimport jakarta.persistence.MappedSuperclass;\n\nimport java.time.Instant;\n\n/**\n * 소프트 삭제 기반 추상 엔티티\n *\n * <p>BaseAuditEntity를 상속하고 소프트 삭제 기능 추가</p>\n *\n * <p>제공 기능:</p>\n * <ul>\n *   <li>deleted: 삭제 여부 플래그</li>\n *   <li>deletedAt: 삭제 시각</li>\n *   <li>softDelete(): 소프트 삭제 실행 메서드</li>\n *   <li>restore(): 복원 메서드</li>\n * </ul>\n *\n * <p>주의사항:</p>\n * <ul>\n *   <li>조회 시 deleted = false 조건 필수</li>\n *   <li>복원 시 deletedAt = null로 초기화</li>\n *   <li>물리적 삭제(DELETE)는 배치 작업으로 별도 처리</li>\n * </ul>\n *\n * <p>QueryDSL 조회 예시:</p>\n * <pre>{@code\n * queryFactory\n *     .selectFrom(order)\n *     .where(order.deleted.isFalse())  // 소프트 삭제되지 않은 것만\n *     .fetch();\n * }</pre>\n */\n@MappedSuperclass\npublic abstract class SoftDeletableEntity extends BaseAuditEntity {\n\n    @Column(name = \"deleted\", nullable = false)\n    private boolean deleted = false;\n\n    @Column(name = \"deleted_at\")\n    private Instant deletedAt;\n\n    // Getter\n    public boolean isDeleted() {\n        return deleted;\n    }\n\n    public Instant getDeletedAt() {\n        return deletedAt;\n    }\n\n    /**\n     * 소프트 삭제 실행\n     *\n     * <p>deleted = true, deletedAt = 현재 시각으로 설정</p>\n     *\n     * @param deletedAt 삭제 시각 (Domain에서 전달)\n     */\n    public void softDelete(Instant deletedAt) {\n        this.deleted = true;\n        this.deletedAt = deletedAt;\n    }\n\n    /**\n     * 복원 (삭제 취소)\n     *\n     * <p>deleted = false, deletedAt = null로 초기화</p>\n     */\n    public void restore() {\n        this.deleted = false;\n        this.deletedAt = null;\n    }\n}',1,'2026-01-16 06:52:08','2026-01-16 06:52:08',NULL),(20,6,'CONFIG','config/FlywayConfig.java','JAVA','Flyway 콜백 설정 (선택적). 마이그레이션 전후 커스텀 로직 실행.','package com.{bc}.adapter.out.persistence.config;\n\nimport org.flywaydb.core.api.callback.Callback;\nimport org.flywaydb.core.api.callback.Context;\nimport org.flywaydb.core.api.callback.Event;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\n/**\n * Flyway 콜백 설정 (선택적)\n *\n * <p>마이그레이션 이벤트에 대한 커스텀 로직 실행</p>\n *\n * <p>지원 이벤트:</p>\n * <ul>\n *   <li>BEFORE_MIGRATE: 마이그레이션 시작 전</li>\n *   <li>AFTER_MIGRATE: 마이그레이션 완료 후</li>\n *   <li>AFTER_MIGRATE_ERROR: 마이그레이션 실패 시</li>\n *   <li>BEFORE_EACH_MIGRATE: 각 스크립트 실행 전</li>\n *   <li>AFTER_EACH_MIGRATE: 각 스크립트 실행 후</li>\n * </ul>\n *\n * <p>활용 예시:</p>\n * <ul>\n *   <li>마이그레이션 완료 Slack 알림</li>\n *   <li>마이그레이션 실패 시 롤백 알림</li>\n *   <li>마이그레이션 전후 캐시 초기화</li>\n * </ul>\n */\n@Configuration\npublic class FlywayConfig {\n\n    private static final Logger log = LoggerFactory.getLogger(FlywayConfig.class);\n\n    @Bean\n    public Callback flywayCallback() {\n        return new Callback() {\n\n            @Override\n            public boolean supports(Event event, Context context) {\n                return event == Event.BEFORE_MIGRATE\n                    || event == Event.AFTER_MIGRATE\n                    || event == Event.AFTER_MIGRATE_ERROR;\n            }\n\n            @Override\n            public boolean canHandleInTransaction(Event event, Context context) {\n                return true;\n            }\n\n            @Override\n            public void handle(Event event, Context context) {\n                switch (event) {\n                    case BEFORE_MIGRATE -> log.info(\n                        \"[Flyway] 마이그레이션 시작 - Schema: {}\",\n                        context.getConfiguration().getDefaultSchema()\n                    );\n                    case AFTER_MIGRATE -> log.info(\n                        \"[Flyway] 마이그레이션 완료 - Version: {}\",\n                        context.getMigrationInfo() != null\n                            ? context.getMigrationInfo().getVersion()\n                            : \"N/A\"\n                    );\n                    case AFTER_MIGRATE_ERROR -> log.error(\n                        \"[Flyway] 마이그레이션 실패! 롤백 필요\"\n                    );\n                    default -> { }\n                }\n            }\n\n            @Override\n            public String getCallbackName() {\n                return \"FlywayLoggingCallback\";\n            }\n        };\n    }\n}',0,'2026-01-16 06:52:08','2026-01-16 06:52:08',NULL),(21,6,'CONFIG','config/DataSourceHealthConfig.java','JAVA','DataSource 헬스체크 확장 설정 (선택적). HikariCP 풀 상태 모니터링.','package com.{bc}.adapter.out.persistence.config;\n\nimport com.zaxxer.hikari.HikariDataSource;\nimport com.zaxxer.hikari.HikariPoolMXBean;\nimport org.springframework.boot.actuate.health.Health;\nimport org.springframework.boot.actuate.health.HealthIndicator;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.context.annotation.Profile;\n\nimport javax.sql.DataSource;\n\n/**\n * DataSource 헬스체크 확장 설정 (선택적)\n *\n * <p>HikariCP 커넥션 풀 상태를 Actuator 헬스체크에 포함</p>\n *\n * <p>모니터링 항목:</p>\n * <ul>\n *   <li>activeConnections: 현재 사용 중인 커넥션 수</li>\n *   <li>idleConnections: 유휴 커넥션 수</li>\n *   <li>totalConnections: 전체 커넥션 수</li>\n *   <li>threadsAwaitingConnection: 커넥션 대기 중인 스레드 수</li>\n * </ul>\n *\n * <p>Actuator 엔드포인트:</p>\n * <pre>\n * GET /actuator/health/hikariPool\n * </pre>\n */\n@Configuration\n@Profile({\"!test\"})  // 테스트 환경 제외\npublic class DataSourceHealthConfig {\n\n    @Bean\n    public HealthIndicator hikariPoolHealthIndicator(DataSource dataSource) {\n        return () -> {\n            if (!(dataSource instanceof HikariDataSource hikariDataSource)) {\n                return Health.unknown()\n                    .withDetail(\"message\", \"DataSource is not HikariDataSource\")\n                    .build();\n            }\n\n            HikariPoolMXBean poolMXBean = hikariDataSource.getHikariPoolMXBean();\n            if (poolMXBean == null) {\n                return Health.down()\n                    .withDetail(\"message\", \"HikariPool not initialized\")\n                    .build();\n            }\n\n            int activeConnections = poolMXBean.getActiveConnections();\n            int idleConnections = poolMXBean.getIdleConnections();\n            int totalConnections = poolMXBean.getTotalConnections();\n            int threadsAwaiting = poolMXBean.getThreadsAwaitingConnection();\n            int maxPoolSize = hikariDataSource.getMaximumPoolSize();\n\n            // 풀 사용률 계산\n            double poolUsage = (double) activeConnections / maxPoolSize * 100;\n\n            Health.Builder builder;\n            if (poolUsage >= 90) {\n                builder = Health.down()\n                    .withDetail(\"warning\", \"Connection pool usage over 90%\");\n            } else if (poolUsage >= 70) {\n                builder = Health.up()\n                    .withDetail(\"warning\", \"Connection pool usage over 70%\");\n            } else {\n                builder = Health.up();\n            }\n\n            return builder\n                .withDetail(\"poolName\", hikariDataSource.getPoolName())\n                .withDetail(\"activeConnections\", activeConnections)\n                .withDetail(\"idleConnections\", idleConnections)\n                .withDetail(\"totalConnections\", totalConnections)\n                .withDetail(\"maxPoolSize\", maxPoolSize)\n                .withDetail(\"poolUsagePercent\", String.format(\"%.1f%%\", poolUsage))\n                .withDetail(\"threadsAwaitingConnection\", threadsAwaiting)\n                .build();\n        };\n    }\n}',0,'2026-01-16 06:52:08','2026-01-16 06:52:08',NULL);

-- ============================================================
-- End of V3 migration
-- ============================================================
